<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book Club Ranking Survey</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2, h3 {
      text-align: center;
      color: #333;
    }
    .book {
      margin-bottom: 20px;
    }
    label {
      font-weight: bold;
    }
    select {
      margin-top: 5px;
      width: 100%;
      padding: 5px;
    }
    button {
      display: block;
      margin: 30px auto;
      padding: 10px 20px;
      font-size: 16px;
    }
    .results, .tally {
      margin-top: 30px;
    }
    .vote-entry {
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Rank Your Top 5 Book Club Picks</h1>
    <form id="rankingForm">
      <div id="bookList"></div>
      <input type="text" id="voterName" placeholder="Your name" required style="width: 100%; padding: 8px; margin-top: 10px;" />
      <button type="submit">Submit Rankings</button>
    </form>

    <div class="results" id="results"></div>
    <div class="tally" id="tally">
      <h2>ðŸ“Š Current Ranking (Ranked Choice Tally)</h2>
      <div id="voteTally"></div>
      <h3>Voters So Far</h3>
      <div id="voterList"></div>
    </div>
  </div>

  <script>
      const books = [
      {
        title: "The Outlaw Ocean",
        author: "Ian Urbina",
        summary: "This gripping work of investigative journalism explores the lawless frontier of the world's oceans. Urbina uncovers stories of pirates, human trafficking, rogue fishers, and vigilantes operating beyond any nationâ€™s jurisdiction. Based on five years of reporting, the book dives deep into the chaos and violence often hidden beneath the surface. Itâ€™s a powerful expose of how our economies rely on these shadowy practices at sea."
      },
      {
        title: "The Simple Art of Killing a Woman",
        author: "PatrÃ­cia Melo",
        summary: "In this genre-bending novel, a young lawyer flees an abusive relationship and finds herself in the Amazon. There, she becomes immersed in the epidemic of violence against women in Brazil. Through mystical visions and ancestral voices, she unearths personal and collective trauma. The book blends poetic prose, social commentary, and magical realism in a haunting narrative."
      },
      {
        title: "The Storytellerâ€™s Secret",
        author: "Badani",
        summary: "Jaya, a journalist grieving her third miscarriage, travels to India in search of her family's past. There she learns the powerful story of her grandmother, a storyteller whose courage helped shape generations. The journey brings healing, cultural connection, and unexpected revelations. It's a poignant exploration of loss, resilience, and the ties that bind women across time."
      },
      {
        title: "Someone Knows My Name",
        author: "Lawrence Hill",
        summary: "Aminata Diallo is abducted from West Africa and enslaved in the American South. Her intelligence and determination lead her through the horrors of slavery, war, and separation from her family. She eventually helps write the historical 'Book of Negroes' and joins the abolitionist cause. This epic novel follows her extraordinary life from bondage to freedom and advocacy."
      },
      {
        title: "The Kingmakerâ€™s Daughter",
        author: "Philippa Gregory",
        summary: "Anne Neville, daughter of the powerful Earl of Warwick, is used as a pawn in her father's ambition to control the throne of England. As political tides turn, she navigates a dangerous world of betrayal, marriage, and power. Married young to a royal rival, she must rely on her wits to survive. Gregory paints a vivid picture of ambition and female agency in the Wars of the Roses."
      },
      {
        title: "The Song of Achilles",
        author: "Madeline Miller",
        summary: "This lyrical retelling of the Iliad focuses on the bond between Patroclus and Achilles. As boys, they grow from reluctant companions to inseparable lovers. Their love is tested by war, pride, and fate during the siege of Troy. It's a moving and tragic story of devotion in the shadow of mythology."
      },
      {
        title: "Raising Hare",
        author: "Chloe Dalton",
        summary: "In this quiet, contemplative novel, a woman finds purpose and unexpected companionship raising a wild hare. Through the animalâ€™s growth and eventual independence, she reconnects with her own sense of healing and solitude. The narrative is minimal and reflective, inviting readers into a close communion with nature. Itâ€™s a meditative tale of love, loss, and letting go."
      },
      {
        title: "The Griffin Sistersâ€™ Greatest Hits",
        author: "Jennifer Weiner",
        summary: "Pop duo Cassie and Zoe Griffin rose to fame in the early 2000sâ€”then crashed spectacularly. Two decades later, their estranged lives are shaken up when Zoeâ€™s daughter seeks to reunite them and uncover the real reason they broke up. With wit and emotion, the novel explores sisterhood, fame, and second chances. Itâ€™s a layered story about family secrets and healing."
      },
      {
        title: "Murder Takes a Vacation",
        author: "Laura Lippman",
        summary: "A woman falls for a charming stranger on a cruise, only for him to turn up dead. As the investigation unfolds, sheâ€™s forced to unravel the truth about who he really wasâ€”and why he died. With classic suspense and twists, the book blends romance and murder mystery. Itâ€™s a breezy, engaging thriller perfect for vacation reading."
      },
      {
        title: "Atmosphere",
        author: "Taylor Jenkins Reid",
        summary: "Joan Goodwin, a physics professor, is selected for NASAâ€™s Space Shuttle program in 1980. Training alongside other pioneers, she discovers deep friendships, a transformative love, and her passion for spaceflight. But a tragic mission in 1984 forces her to confront loss and the limits of her dreams. Itâ€™s a story of ambition, identity, and what it means to find your place in the universe."
      }
    ];

    const bookList = document.getElementById("bookList");
    books.forEach((book, index) => {
      const div = document.createElement("div");
      div.classList.add("book");
      div.innerHTML = `
        <label for="rank${index}">${book.title} by ${book.author}</label>
        <p>${book.summary}</p>
        <select name="rank${index}" id="rank${index}" data-title="${book.title}">
          <option value="">â€“</option>
          <option value="1">1st</option>
          <option value="2">2nd</option>
          <option value="3">3rd</option>
          <option value="4">4th</option>
          <option value="5">5th</option>
        </select>
      `;
      bookList.appendChild(div);
    });

    async function loadVotesFromSheet() {
      const res = await fetch("https://script.google.com/macros/s/AKfycbwE7JmRYZX6Cg83yaW5Y_4hjEvHTkiSHQIUELAJ9i3WvVio0kqDXJKu1a9jkEcDkEIG/exec");
      const data = await res.json();
      updateResults(data);
    }

    document.getElementById("rankingForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const selected = {};
      const seenRanks = new Set();
      for (let [key, value] of formData.entries()) {
        if (value) {
          const title = document.getElementById(key).dataset.title;
          if (seenRanks.has(value)) {
            alert("Each rank must be unique. Please fix duplicates.");
            return;
          }
          seenRanks.add(value);
          selected[value] = title;
        }
      }

      const voterName = document.getElementById("voterName").value.trim();
      if (!voterName) {
        alert("Please enter your name.");
        return;
      }

      const payload = {
        name: voterName,
        rankings: selected
      };

      await fetch("https://script.google.com/macros/s/AKfycbwE7JmRYZX6Cg83yaW5Y_4hjEvHTkiSHQIUELAJ9i3WvVio0kqDXJKu1a9jkEcDkEIG/exec", {
        method: "POST",
        body: JSON.stringify(payload)
      });

      e.target.reset();
      loadVotesFromSheet();
    });

    function updateResults(votes) {
      if (!votes.length) return;

      const latest = votes[votes.length - 1];
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "<h3>Your Rankings:</h3><ol>" +
        [1,2,3,4,5].map(num => latest.rankings[num] ? `<li>${latest.rankings[num]}</li>` : "<li>â€“</li>").join("") +
        "</ol>";

      const tally = {};
      votes.forEach(vote => {
        for (let i = 1; i <= 5; i++) {
          const title = vote.rankings[i];
          if (title) {
            tally[title] = (tally[title] || 0) + (6 - i);
          }
        }
      });

      const sorted = Object.entries(tally).sort((a, b) => b[1] - a[1]);
      const voteTally = document.getElementById("voteTally");
      voteTally.innerHTML = `<ol>${sorted.map(([title, pts]) => `<li>${title} â€” ${pts} pts</li>`).join("")}</ol>`;

      const voterList = document.getElementById("voterList");
      voterList.innerHTML = votes.map(v => `<div class="vote-entry"><strong>${v.name}</strong>: ` +
        Object.entries(v.rankings).sort(([a], [b]) => a - b).map(([rank, book]) => `${rank}: ${book}`).join(", ") +
        `</div>`).join("");
    }

    window.onload = loadVotesFromSheet;
  </script>
</body>
</html>
